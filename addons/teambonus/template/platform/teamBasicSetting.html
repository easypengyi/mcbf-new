{block name="main"}

		<!-- page -->
		<ul class="nav nav-tabs v-nav-tabs" role="tablist">
			<li role="presentation" class="active"><a href="{:__URL('ADDONS_MAINteamBasicSetting')}"  class="flex-auto-center">基础设置</a></li>
			<li role="presentation"><a href="{:__URL('ADDONS_MAINteamSettlementSetting')}"  class="flex-auto-center">结算设置</a></li>
			<li role="presentation"><a href="{:__URL('ADDONS_MAINteamApplicationAgreement')}&type=2"  class="flex-auto-center">申请协议</a></li>
			<li role="presentation"><a href="{:__URL('ADDONS_MAINteamApplicationAgreement')}&type=1"  class="flex-auto-center">文案样式</a></li>
			<li role="presentation"><a href="{:__URL('ADDONS_MAINteamApplicationAgreement')}&type=3"  class="flex-auto-center">推送通知</a></li>
		</ul>
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane fade in active" id="base">
				<form class="form-horizontal form-validate pt-15 widthFixedForm">
					<div class="form-group">
						<label class="col-md-2 control-label">团队分红</label>
						<div class="col-md-5">
							<div class="switch-inline">
								<input type="checkbox" name="teambonus_status" id="teambonus_status" {if condition="$website.is_use eq 1"}checked{/if}>
								<label for="teambonus_status" class=""></label>
							</div>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-2 control-label">店铺分红</label>
						<div class="col-md-5">
							<div class="switch-inline">
								<input type="checkbox" name="teambonus_admin_status" id="teambonus_admin_status" {if condition="$website.teambonus_admin_status eq 1"}checked{/if}>
								<label for="teambonus_admin_status" class=""></label>
							</div>
							<div class="mb-0 help-block">开启后入驻店铺商品分红产生的金额由店铺承担，开启前已发布的商品默认参与分红，请提醒入驻店铺编辑商品及时调整分红比例</div>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-2 control-label"><span class="text-bright">*</span>成为队长条件</label>
						<div class="col-md-8">
							<div>
							<label class="radio-inline">
								<input type="radio" value="1" name="teamagentcondition" required {if condition="$website.teamagent_condition eq 1"}checked{/if}> 满足所有勾选条件
							</label>
							<label class="radio-inline">
								<input type="radio" value="2" name="teamagentcondition" required {if condition="$website.teamagent_condition eq 2"}checked{/if}> 满足勾选条件之一即可
							</label>
							<label class="radio-inline">
								<input type="radio"  value="-1" name="teamagentcondition" required {if condition="$website.teamagent_condition eq -1"}checked{/if}> 申请成为队长
							</label>
							</div>
						</div>
					</div>
					<div class="form-group" id="iscondition">
						<label class="col-md-2 control-label"></label>
						<div class="col-md-8">
							<div class="form-additional" style="width: auto">
								<div class="form-group">
									<label class="col-md-4 control-label"><input type="checkbox" name="teamagentconditions" value="1"> 内购订单金额满</label>
									<div class="col-md-7 control-group">
										<div class="input-group">
											<input type="number" class="form-control" min="0" name="pay_money" value="{if $website.pay_money}{$website.pay_money}{/if}">
											<div class="input-group-addon">元</div>
										</div>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-4 control-label"><input type="checkbox" name="teamagentconditions" value="2"> 团队人数满</label>
									<div class="col-md-7 control-group">
										<div class="input-group">
											<input type="number" class="form-control" min="0" name="number" value="{if $website.number}{$website.number}{/if}">
											<div class="input-group-addon">人</div>
										</div>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-4 control-label"><input type="checkbox" name="teamagentconditions" value="3"> 一级分销商满</label>
									<div class="col-md-7 control-group">
										<div class="input-group">
											<input type="number" class="form-control" min="0" name="one_number" value="{if $website.one_number}{$website.one_number}{/if}">
											<div class="input-group-addon">人</div>
										</div>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-4 control-label"><input type="checkbox" name="teamagentconditions" value="4"> 二级分销商满</label>
									<div class="col-md-7 control-group">
										<div class="input-group">
											<input type="number" class="form-control" min="0" name="two_number" value="{if $website.two_number}{$website.two_number}{/if}">
											<div class="input-group-addon">人</div>
										</div>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-4 control-label"><input type="checkbox" name="teamagentconditions" value="5"> 三级分销商满</label>
									<div class="col-md-7 control-group">
										<div class="input-group">
											<input type="number" class="form-control" min="0" name="three_number" value="{if $website.three_number}{$website.three_number}{/if}">
											<div class="input-group-addon">人</div>
										</div>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-4 control-label"><input type="checkbox" name="teamagentconditions" value="6"> 一级订单金额满</label>
									<div class="col-md-7 control-group">
										<div class="input-group">
											<input type="number" class="form-control" min="0" name="order_money" value="{if $website.order_money}{$website.order_money}{/if}">
											<div class="input-group-addon">元</div>
										</div>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-4 control-label"><input type="checkbox" name="teamagentconditions" value="11"> 团队订单金额满</label>
									<div class="col-md-7 control-group">
										<div class="input-group">
											<input type="number" class="form-control" min="0" name="up_team_money" value="{if $website.up_team_money}{$website.up_team_money}{/if}">
											<div class="input-group-addon">元</div>
										</div>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-4 control-label"><input type="checkbox" name="teamagentconditions" value="7"> 购买指定商品</label>
									<div class="col-md-7 control-group">
										<div class="picture-list">
											<a href="javascript:;" class="btn btn-primary search_goods ">
												选择商品
											</a>
											<input type="text" class="visibility" data-visi-type="singlePicture" name="picture-Logo">
											<input type="hidden" class="selectgoods_ids" id="selectgoods_ids" name="selectgoods_ids" value="{$website.goods_id}" >
										</div>
									</div>
									<div class="col-md-12 control-group">
										<table class="table v-table table-auto-center" id="selfGoodsList">
												<thead>
												<tr>
													<th class="col-md-4">商品信息</th>
													<th >库存</th>
													<th class="col-md-2 pr-14 operationLeft">操作</th>
												</tr>
												</thead>
												<tbody id="goods_list">
													{if $website.goods_list}
													{foreach $website.goods_list as $vo} 
														<tr>
														<td>
														<div class="showUser media text-left ">
														<div class="media-left"><img id="actar" src='{:__IMG($vo.pic)}' style="max-width:none;width:60px;height:60px;"></div>
														<div class="media-body break-word">
														<div class="line-2-ellipsis nick_name">{$vo.goods_name}</div>
														<div class="line-1-ellipsis text-danger mobile">{$vo.goods_price}</div>
														</div>
														</div>
														</td>
														<td>{$vo.goods_stock}</td>
														<td class="col-md-2 pr-14 operationLeft text-red1" data-id="{$vo.goods_id}" style="cursor:pointer">删除</td>
														</tr>
													{/foreach}
													{/if}
												</tbody>
											</table>
									</div>
									
								</div>
							</div>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-2 control-label">队长自动审核</label>
						<div class="col-md-5">
							<div class="switch-inline">
								<input type="checkbox" name="teamagentcheck" id="teamagentcheck" {if condition="$website.teamagent_check eq 1"}checked{/if}>
								<label for="teamagentcheck" class=""></label>
							</div>
							<div class="help-block mb-0">开启后无需手动审核团队队长</div>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-2 control-label">队长必须完善资料</label>
						<div class="col-md-5">
							<div class="switch-inline">
								<input type="checkbox" name="teamagentdata" id="teamagentdata" {if condition="$website.teamagent_data eq 1"}checked{/if}>
								<label for="teamagentdata" class=""></label>
							</div>
							<div class="mb-0 help-block">开启后未完善资料的队长需要完善资料才能进行操作，若还不是队长则需要提交资料申请审核。</div>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-2 control-label">内购分红</label>
						<div class="col-md-5">
							<div class="switch-inline">
								<input type="checkbox" name="purchasetype" id="purchasetype" {if condition="$website.purchase_type eq 1"}checked{/if}>
								<label for="purchasetype" class=""></label>
							</div>
							<div class="help-block mb-0">开启分红内购，代理商自己购买商品，可获得团队分红</div>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-2 control-label">是否开启级差</label>
						<div class="col-md-5">
							<div class="switch-inline">
								<input type="checkbox" name="gradationstatus" id="gradationstatus" {if condition="$website.gradation_status eq 1"}checked{/if}>
								<label for="gradationstatus" class=""></label>
							</div>
							<div class="help-block mb-0">开启级差后每个队长所拿的分红比例为自己等级减去下级的比例</div>
						</div>
					</div>

					<div class="form-group" id="level_awards"> 
						<label class="col-md-2 control-label">平级奖</label>
						<div class="col-md-5">
							<select class="form-control" id="level_award" name="level_award" >
								<option value="">不开启</option>
								<option value="1"  {if condition="$website.level_award eq 1"} selected="selected"{/if}>平一级</option>
								<option value="2"  {if condition="$website.level_award eq 2"} selected="selected"{/if}>平二级</option>
								<option value="3"  {if condition="$website.level_award eq 3"} selected="selected"{/if}>平三级</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-2 control-label">是否开启跳级降级</label>
						<div class="col-md-5">
							<div class="switch-inline">
								<input type="checkbox" name="teamagentgrade" id="teamagentgrade" {if condition="$website.teamagent_grade eq 1"}checked{/if}>
								<label for="teamagentgrade" class=""></label>
							</div>
							<div class="help-block mb-0">开启后，团队队长按照权重顺序跳级或跳降级，只要升级或降级条件满足则会一直执行</div>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-2 control-label">队长发货</label>
						<div class="col-md-5">
							<div class="switch-inline">
								<input type="checkbox" name="teamagent_delivery" id="teamagent_delivery" {if condition="$website.teamagent_delivery eq 1"}checked{/if}>
								<label for="teamagent_delivery" class=""></label>
							</div>
							<div class="help-block mb-0">开启后团队下线的订单队长可以在分红中心发货，如一个团队出现多个队长，则离消费者最近一个队长发货</div>
						</div>
					</div>
					<div class="form-group"></div>
					<div class="form-group">
						<label class="col-md-2 control-label"></label>
						<div class="col-md-8">
							<button class="btn btn-primary add" type="submit">保存</button>
							<a href="javascript:history.go(-1);" class="btn btn-default">返回</a>
						</div>
					</div>

				</form>
			</div>
		</div>

		<!-- page end -->
{/block}
{block name="script"}
<script>
    require(['util'],function(util){
        loading();
        function loading(){
            var teamagent_conditions = "{$website.teamagent_conditions}";
            teamagent_conditions = teamagent_conditions.split(',');
            for(var i = 0; i < teamagent_conditions.length;i++){
                $('[name="teamagentconditions"][value="'+teamagent_conditions[i]+'"]').prop("checked", true);
            }
            var teamagent_condition = "{$website.teamagent_condition}";
			var gradation_status = "{$website.gradation_status}";
            if(teamagent_condition==-1){
                $("#iscondition").hide();
			}else{
                $("#iscondition").show();
			}
			if(gradation_status == 1){
				$("#level_awards").show();
			}else{
				$("#level_awards").hide();
			}
		}
		$('body').on('click','.operationLeft', function () {
			$(this).parents('tr').remove();
			var id = $(this).data('id');
			changeGoods(id,1);
		})
		function changeGoods(id,type){
			var selectgoods_ids = $('#selectgoods_ids').val();
			if(type == 1){
				//删除
				var strs = new Array(); //定义一数组
				strs = selectgoods_ids.split(","); //字符分割
				console.log('delect',strs);
				for (i=0; i<strs.length; i++ ){
					if(strs[i] == id){
						strs.splice(i,1)
					}
				}
				if(strs.length>0){
					b = strs.join(",");
					$("#selectgoods_ids").val(b);
				}else{
					$("#selectgoods_ids").val('');
					$('#selfGoodsList').addClass('hide');
				}
			}else{
				//增加
				$('#selfGoodsList').removeClass('hide');
				//存在则更新 不存在则直接写入
				if(selectgoods_ids){
					var str = selectgoods_ids + ','+id;
					console.log('str',str)
					$("#selectgoods_ids").val(str);
				}else{
					$("#selectgoods_ids").val(id);
				}
			}
		}
		// 移除图片
        $('.picture-list12').on('click','.icon-danger',function(e){
            e && e.stopPropagation ? e.stopPropagation() : window.event.cancelBubble = true;
            var id=$(this).parents('.picture-list12-pic').attr('data-id');
            $(this).parents('.picture-list12-pic').remove();
            var str=$("#goodsid").val();
            var str1 = str.split(',');
			console.log('str1',str1,'id',id)
            str1.remove(id);
            var str2 = str1.join(',');
            $("#goodsid").val(str2);
        })
		$('.picture-list1').on('click','.icon-danger',function(e){
            e && e.stopPropagation ? e.stopPropagation() : window.event.cancelBubble = true;
            var id=$(this).parents('.picture-list1-pic').attr('data-id');
            $(this).parents('.picture-list1-pic').remove();
            var str=$("#goodsid").val();
            var str1 = str.split(',');
			console.log('str1',str1,'id',id)
            str1.remove(id);
            var str2 = str1.join(',');
            $("#goodsid").val(str2);
        })
        $('body').on('click','.search_goods', function () {
            // var url = "{:__URL('PLATFORM_MAIN/goods/selectGoodsList')}";
			var url = "{:__URL('PLATFORM_MAIN/goods/selectNumGoodsList')}?goodsid="+$("#selectgoods_ids").val();
            util.confirm('选择商品','url:'+url, function () {
                var goods_id = this.$content.find('#goods_id').val();
				console.log('goods_id-add',goods_id)
				$("#selectgoods_ids").val(goods_id);
                $.ajax({
                    type:"post",
                    url:" {:__URL('PLATFORM_MAIN/goods/selectNumGoodsInfo')}",
                    data:{
                        'goods_id':goods_id,
                    },
                    async:true,
                    success:function (data) {
                        if (data) {
                            var html='';
                            for(var i=0;i<data.length;i++){
								html += '<tr>';
								html += '<td>';
								html += '<div class="showUser media text-left ">';
								html += '<div class="media-left"><img id="actar" src="'+data[i]['pic_cover_small']+'" style="max-width:none;width:60px;height:60px;"></div>';
								html += '<div class="media-body break-word">';
								html += '<div class="line-2-ellipsis nick_name">'+data[i]['goods_name']+'</div>';
								html += '<div class="line-1-ellipsis text-danger mobile">'+data[i]['price']+'</div>';
								html += '</div>';
								html += '</div>';
								html += '</td>';
								html += '<td>'+data[i]['stock']+'</td>';
								html += '<td class="text-red1 col-md-2 pr-14 operationLeft" data-id="'+data[i]['goods_id']+'" style="cursor:pointer">删除</td>';
								html += '</tr>';
							}
							$('#goods_list').html(html);
							$('#selfGoodsList').removeClass('hide');
							// changeGoods(goods_id,2);
                            // $(".picture-list1").html(html);
                        }
                    }
                });
            },'large')
        })
        $("input[name='teamagentconditions']").click(function () {
            if($(this).is(':checked')){
                var vals=$(this).val();
                if(vals!=7 || $("input[name='selectgoods_ids']").val()==''){
                    $(this).parent(".control-label").siblings(".control-group").find("input").attr("required",true);
                }
            } else{
                $(this).parents(".form-group").removeClass('has-error');
                $(this).parents(".form-group").find('.help-block-error').html('');
                $(this).parent(".control-label").siblings(".control-group").find("input").removeAttr("required",true);
            }
        })
        $("input[name='teamagentcondition']").click(function () {
            if($(this).is(':checked') && $("input[name='teamagentcondition']:checked").val()==-1){
                $("#iscondition").hide();
            } else{
                $("#iscondition").show();
            }
        })
		$("input[name='gradationstatus']").click(function () {
			var gradationstatus = $("input[name='gradationstatus']").is(':checked')? 1: 0;
            if(gradationstatus==1){
                $("#level_awards").show();
            } else{
                $("#level_awards").hide();
            }
        })
        function isInArray(arr,value){
            for(var i = 0; i < arr.length; i++){
                if(value === arr[i]){
                    return true;
                }
            }
            return false;
        }
        util.validate($('.form-validate'),function(form){
            var teambonus_status = $("input[name='teambonus_status']").is(':checked')? 1: 0;
            var teamagentcondition = $("input[name='teamagentcondition']:checked").val();
            var teamagentconditions = $("input:checkbox[name='teamagentconditions']:checked").map(function(index,elem) {
                return $(elem).val();
            }).get().join(',');
            var arr=teamagentconditions.split(',');
            if(isInArray(arr,"7")){
                var goods_id = $("input[name='selectgoods_ids']").val();
            }else{
                var goods_id ='';
            }
            var pay_money = $("input[name='pay_money']").val();
            var number = $("input[name='number']").val();
            var one_number = $("input[name='one_number']").val();
            var two_number = $("input[name='two_number']").val();
            var three_number = $("input[name='three_number']").val();
            var order_money = $("input[name='order_money']").val();
			var up_team_money = $("input[name='up_team_money']").val();//团队订单金额
            var teamagentcheck = $("input[name='teamagentcheck']").is(':checked') ? 1 : 2;
            var teamagentgrade = $("input[name='teamagentgrade']").is(':checked') ? 1 : 2;
            var purchasetype = $("input[name='purchasetype']").is(':checked') ? 1 : 2;
            var gradationstatus = $("input[name='gradationstatus']").is(':checked') ? 1 : 2;
			var level_award = $("#level_award").val();//平级设置
			var teamagent_delivery = $("input[name='teamagent_delivery']").is(':checked') ? 1 : 2;//队长发货
			var teamagentdata = $("input[name='teamagentdata']").is(':checked') ? 1 : 2;
			var teambonus_admin_status = $("input[name='teambonus_admin_status']").is(':checked')? 1 : 0; //是否开启店铺分红
            if(teamagentcondition>0 && teamagentconditions==''){
                util.message('请填写成为队长条件','danger');
                return false;
            }
            $.ajax({
                type:"post",
                url:"{$teamBasicSettingUrl}",
                data:{
					'level_award':level_award,
                    'teambonus_status':teambonus_status,
                    'number':number,
                    'one_number':one_number,
                    'two_number':two_number,
                    'three_number':three_number,
                    'teamagent_condition': teamagentcondition,
                    'teamagent_conditions':teamagentconditions,
                    'pay_money':pay_money,
                    'order_money':order_money,
					'up_team_money':up_team_money,
                    'teamagent_check':teamagentcheck ,
                    'teamagent_grade':teamagentgrade,
                    'goods_id':goods_id,
                    'purchase_type':purchasetype,
                    'gradation_status':gradationstatus,
                    'teamagent_data':teamagentdata,
                    'teamagent_delivery':teamagent_delivery,
					'teambonus_admin_status':teambonus_admin_status
                },
                async:true,
                success:function (data) {
                    if (data['code']>0) {
                        util.message(data["message"], 'success', "{:__URL('ADDONS_MAINteamBasicSetting')}");
                    }else if(data['code']==-3) {
                        util.message('该应用有未完成分红数据，暂时无法关闭，必须等分红结算完成才可以进行关闭操作！', 'danger', "{:__URL('ADDONS_MAINteamBasicSetting')}");
                    }else{
                        util.message(data["message"], 'danger');
                    }
                }
            });
        })
    })
</script>
{/block}